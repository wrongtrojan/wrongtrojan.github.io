+++
title = "12.异常处理"
weight=15
date = 2025-12-08
draft = false
tags=["Cpp","异常"]
+++
<!--more-->

       在环境条件出现意外或用户使用操作不当时应该有正确合理的处理办法

## 异常处理的基本思想

       程序运行中可预料但不可避免的错误，给出适当的提示信息
       Cpp异常处理机制让异常的引发和处理不必在同一函数

## Cpp异常处理的实现

### 异常处理的语法
       throw
           throw表达式语法
               throw 表达式
           throw的操作数标识异常类型语法与return语句相似
       try
           try块语法
               try 复合语句
               catch(异常声明) 复合语句
               catch(异常声明) 复合语句
               ...
           try子句后的复合语句是代码的保护段(预料到可能发生异常的程序代码)
       catch
           catch子句后的复合语句是异常处理程序，捕获throw表达式抛出的异常
           catch子句后的复合语句中可以使用throw将源异常对象再次抛出
           catch子句后的异常声明指明子句处理的异常类型和异常参数名称(与函数形参类似)
       抛出的异常与catch子句声明的异常类型匹配情况
           catch子句中异常类型就是抛出异常对象的类型或引用
           catch子句中异常类型是抛出异常对象的公共基类或引用
           抛出的异常类型为指针且可隐含转换catch子句指针型异常类型

### 异常接口声明
       为加强程序可读性，可在函数声明中列出函数可能抛出的所有异常类型
           void fun() throw(A,B,C,D);
       如果函数声明中没有包括异常接口声明，函数可以抛出任何类型yichang
           void fun()
       可以声明不抛出任何类型异常的函数
           void fun() throw()
       *函数抛出接口声明不允许抛出的异常时，unexpected函数会被调用
        unexpected函数缺省行为是调用terminate函数终止程序

## 异常处理中的构造与析构

       Cpp异常处理具有为异常抛出前构造的所有局部对象自动调用析构函数的能力
       从进入try块到异常抛出前在栈上构造的所有对象都会被自动析构，称为栈的解旋(unwinding)

## 标准程序库异常处理

       <exception> 
           bad_alloc  用new动态分配空间失败
       <new>
           bad_cast  执行dynamic_cast失败
       <typeinfo>
           bad_typeid  对某个空指针p指向typeid(*p)
           bad_exception  fun()抛出声明不允许异常时调用unexpected()
                          而unexpected()又一次抛出fun()不允许异常
       <ios>
           ios_base::failure  用来表示输入输出流执行过程中的错误
       <stdexcept>
           runtime_error 派生
               underflow_error  算术运算向下溢出
               overflow_error  算术运算向上溢出
               range_over  内部计算时发生作用域的错误
           logic_error 派生
               out_of_range  表示一个参数值不在允许范围内
               length_error  尝试创建一个长度超过最大允许值的对象
               invalid_argument  表示向函数传入无效参数
               domain_error  执行一段程序所需要的先决条件不满足
           *runtime/logic_error两个类及其派生类都有接受const string &"错误信息"的构造函数
            调用对象what函数可以得到构造时错误信息

## *noexcept异常说明

       使用noexcept说明标识函数不会抛出异常
       语法形式
           type func() noexcept;
       noexcept使用时要保证声明与定义的一致性
       若函数使用说明但函数中包含异常抛出,执行时依旧可能异常终止
       noexcept说明符与noexcept运算符配套使用
           noexcept运算符判断函数是否使用了noexcept说明